<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>In-App Browser Detection</title>

</head>

<body>
  <div class="content">
    <div class="feature-card">
      <h2>üîß Detection Information</h2>
      <p><strong>Browser Detection:</strong> <span id="detection-status">Detecting...</span></p>
      <p><strong>User Agent:</strong> <span id="user-agent" style="word-break: break-all; font-size: 12px;"></span>
        <button id="copy-ua-btn"
          style="margin-left: 10px; padding: 5px 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">Copy
          UA</button>
      </p>

      <div style="margin-top: 14px; font-size: 12px; line-height: 1.6;">
        <p><strong>outerWidth / innerWidth:</strong> <span id="ow">-</span> / <span id="iw">-</span></p>
        <p><strong>outerHeight / innerHeight:</strong> <span id="oh">-</span> / <span id="ih">-</span></p>
        <p><strong>navigator.share exists:</strong> <span id="share-exists">-</span></p>
        <p><strong>display-mode: standalone:</strong> <span id="standalone">-</span></p>
        <p><strong>document.referrer:</strong> <span id="doc-referrer" style="word-break: break-all;">-</span></p>
      </div>
    </div>
  </div>

  <script type="module">
    // Import the library from lib/ directory
    import { InAppBrowserDetector, PlatformUtils, BrowserOpener } from './dist/index.js';

    // Detect if in-app browser
    const isInApp = InAppBrowserDetector.detectInAppBrowser();
    const browserName = InAppBrowserDetector.getBrowserName();

    // Get platform information
    const os = PlatformUtils.getOS();
    const osVersion = PlatformUtils.getOSVersion();
    const browserVersion = PlatformUtils.getBrowserVersion();

    // Update detection status
    const statusElement = document.getElementById('detection-status');
    const deviceDetails = [];
    if (os !== 'Unknown') {
      const osInfo = osVersion !== 'Unknown' ? `${os} ${osVersion}` : os;
      deviceDetails.push(osInfo);
    }
    if (browserVersion !== 'Unknown') {
      deviceDetails.push(`${browserName} ${browserVersion}`);
    }
    const detailsString = deviceDetails.length > 0 ? ` - ${deviceDetails.join(', ')}` : '';

    if (isInApp) {
      statusElement.innerHTML = `<span style="color: #ff6b6b; font-weight: bold;">üîí In-App Browser Detected (${browserName})${detailsString}</span>`;
      // Show warning banner (dismissible) with browser buttons
      if (!document.querySelector('.in-app-warning')) {
        const banner = document.createElement('div');
        banner.className = 'in-app-warning';
        // Inline essential styles so it works without external CSS
        banner.setAttribute('style', 'position:fixed;top:0;left:0;right:0;background:#ff6b6b;color:#fff;padding:15px 20px;font-size:14px;z-index:10000;border-bottom:1px solid #ff4757;box-shadow:0 2px 10px rgba(0,0,0,0.2)');

        const isChromeAvailable = BrowserOpener.isChromeAvailable();
        const isSafariAvailable = BrowserOpener.isSafariAvailable();

          banner.innerHTML = `
            <div style="display:flex;flex-direction:column;gap:12px;">
              <div style="display:flex;align-items:center;justify-content:center;gap:12px;">
                <span>‚ö†Ô∏è You're viewing this in ${browserName}'s in-app browser.</span>
              </div>
            <div style="display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap;">
              
              <a href="${window.location.href}" class="native-open-link" style="background: #34c759; border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; display: inline-flex; align-items: center; gap: 6px; text-decoration: none;">
                <span>üîó</span> Long Press To Open in Chrome
              </a>
              if you not open in chrome, for email otp you need to go back to gmail so then you will lost your session and you need to start again from intial.
            </div>
          </div>
        `;

        const chromeBtn = banner.querySelector('.open-chrome-btn');
        if (chromeBtn) {
          chromeBtn.addEventListener('click', () => {
            BrowserOpener.openInChrome();
          });
        }

        const safariBtn = banner.querySelector('.open-safari-btn');
        if (safariBtn) {
          safariBtn.addEventListener('click', () => {
            BrowserOpener.openInSafari();
          });
        }

        document.body.appendChild(banner);
      }
    } else {
      statusElement.innerHTML = `<span style="color: #28a745; font-weight: bold;">üåê Regular Browser (${browserName})${detailsString}</span>`;
      // Ensure banner is removed in regular browsers
      const existingBanner = document.querySelector('.in-app-warning');
      if (existingBanner) existingBanner.remove();
    }

    // Update user agent
    const userAgentElement = document.getElementById('user-agent');
    userAgentElement.textContent = navigator.userAgent;

    // Update diagnostics
    document.getElementById('ow').textContent = String(window.outerWidth);
    document.getElementById('iw').textContent = String(window.innerWidth);
    document.getElementById('oh').textContent = String(window.outerHeight);
    document.getElementById('ih').textContent = String(window.innerHeight);
    document.getElementById('share-exists').textContent = typeof navigator.share !== 'undefined' ? 'true' : 'false';
    const isStandalone = window.matchMedia && window.matchMedia('(display-mode: standalone)').matches;
    document.getElementById('standalone').textContent = isStandalone ? 'true' : 'false';
    document.getElementById('doc-referrer').textContent = document.referrer || '';

    // Copy UA button functionality
    const copyBtn = document.getElementById('copy-ua-btn');
    copyBtn.addEventListener('click', async () => {
      const userAgent = navigator.userAgent;
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(userAgent);
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Copied!';
          copyBtn.style.background = '#28a745';
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = '#667eea';
          }, 2000);
        } else {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = userAgent;
          textArea.style.position = 'fixed';
          textArea.style.left = '-9999px';
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          const originalText = copyBtn.textContent;
          copyBtn.textContent = 'Copied!';
          copyBtn.style.background = '#28a745';
          setTimeout(() => {
            copyBtn.textContent = originalText;
            copyBtn.style.background = '#667eea';
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
        // Last resort: show prompt
        window.prompt('Copy User Agent:', userAgent);
      }
    });

    // Global function for backwards compatibility
    window.copyUserAgent = () => {
      copyBtn.click();
    };

    // Global function for backwards compatibility
    window.getCurrentPageUrl = () => {
      return InAppBrowserDetector.getCurrentPageUrl();
    };
  </script>

  <script>
    // Fallback: Show error if modules fail to load
    window.addEventListener('error', (e) => {
      if (e.filename && e.filename.includes('dist/index.js')) {
        const statusElement = document.getElementById('detection-status');
        if (statusElement && statusElement.textContent === 'Detecting...') {
          statusElement.innerHTML = '<span style="color: #ff6b6b;">‚ùå Module loading failed. Check console for errors.</span>';
        }
      }
    });

    // Also try to detect after a delay as a fallback
    setTimeout(() => {
      const statusElement = document.getElementById('detection-status');
      if (statusElement && statusElement.textContent === 'Detecting...') {
        console.warn('Detection still showing "Detecting..." - module may not have loaded');
        statusElement.innerHTML = '<span style="color: #ff6b6b;">‚ùå Detection failed. Please check the console.</span>';
      }
    }, 1000);
  </script>
</body>

</html>